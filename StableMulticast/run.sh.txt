#!/bin/bash

# Define paths
SRC_DIR="src"
BIN_DIR="bin"
STABLE_MULTICAST_PACKAGE="StableMulticast"
MAIN_APP="MyApplication"

# Clean up previous build
echo "Cleaning up..."
rm -rf "$BIN_DIR"
mkdir -p "$BIN_DIR"

# Compile the StableMulticast package
echo "Compiling StableMulticast package..."
javac -d "$BIN_DIR" "$SRC_DIR"/"$STABLE_MULTICAST_PACKAGE"/*.java

# Compile the user application
echo "Compiling user application..."
javac -d "$BIN_DIR" -cp "$BIN_DIR" "$SRC_DIR"/"$MAIN_APP".java

if [ $? -ne 0 ]; then
    echo "Compilation failed."
    exit 1
fi

echo "Compilation successful. Now you can run instances:"
echo "Example: java -cp bin/ StableMulticast.MyApplication P1 127.0.0.1 5000"
echo "Example: java -cp bin/ StableMulticast.MyApplication P2 127.0.0.1 5001"
echo "Example: java -cp bin/ StableMulticast.MyApplication P3 127.0.0.1 5002"

# You can uncomment the following lines to run multiple instances in the background for testing
# Note: This will run them all from this script. For interactive control, run them in separate terminals.

# echo "Starting P1..."
# java -cp "$BIN_DIR" StableMulticast.MyApplication P1 127.0.0.1 5000 &
# P1_PID=$!
# sleep 2 # Give it time to start

# echo "Starting P2..."
# java -cp "$BIN_DIR" StableMulticast.MyApplication P2 127.0.0.1 5001 &
# P2_PID=$!
# sleep 2

# echo "Starting P3..."
# java -cp "$BIN_DIR" StableMulticast.MyApplication P3 127.0.0.1 5002 &
# P3_PID=$!
# sleep 2

# echo "All instances started. Press Enter to kill them."
# read -r

# kill $P1_PID $P2_PID $P3_PID
# echo "Processes killed."